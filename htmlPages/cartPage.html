<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <!--Font-->
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;700&display=swap" rel="stylesheet">
    <!--Box Icons-->
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        /* General reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        /* Navbar Styles */
    .navbar {
      background-color: #2c3e50 !important;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 15px 0;
    }

    .navbar-brand {
      font-weight: bold;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      margin-right: auto;
    }

    .logospan {
      color: #fff;
    }

    .logospan span {
      color: #FFA500;
    }

    .navbar-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-grow: 1;
      gap: 20px;
    }

    .nav-link {
      color: #fff !important;
      font-size: 1rem;
      transition: color 0.3s ease, transform 0.3s ease;
    }

    .nav-link:hover {
      color: #FFA500 !important;
      transform: translateY(-3px);
    }

    .nav-link.active {
      color: #FFA500 !important;
      font-weight: bold;
    }

    .profile-cart {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-left: auto;
    }

    .profile-cart a {
      color: #fff;
      font-size: 1.2rem;
      transition: color 0.3s ease, transform 0.3s ease;
    }

    .profile-cart a:hover {
      color: #FFA500;
      transform: translateY(-3px);
    }

        /* Cart Item Styles */
        .cart-item {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            padding: 15px;
            animation: fadeInUp 0.6s ease-in-out;
        }

        .cart-item .ms-3 {
            margin-left: 15px;
        }

        .cart-item .btn-outline-secondary {
            background-color: #FFA500;
            color: white;
            transition: background-color 0.3s ease;
        }

        .cart-item .btn-outline-secondary:hover {
            background-color: #FFA500;
        }

        /* Cart Summary Styles */
        .card {
            background-color: #f8f9fa;
            border-radius: 10px;
        }

        .card h4 {
            color: #343a40;
            font-size: 1.3rem;
        }

        .card .btn-primary {
            background-color: #FFA500;
            color: white;
            font-size: 1rem;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .card .btn-primary:hover {
            background-color: #FFA500;
        }
        
    /* Footer */
    .footer {
      background-color: #2c3e50;
      color: white;
      padding: 4rem 2rem;
    }

    .footer .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .footer-section {
      margin-bottom: 1.5rem;
    }

    .footer-section h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #FFA500;
    }

    .footer-section p {
      font-size: 1rem;
      color: #ddd;
    }

    .footer-section ul {
      list-style: none;
      padding: 0;
    }

    .footer-section ul li {
      margin-bottom: 0.75rem;
      font-size: 1rem;
      color: #ddd;
    }

    .footer-section ul li i {
      margin-right: 0.5rem;
      color: #FF6B35;
    }

    .footer-section a {
      color: #ddd;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-section a:hover {
      color: #FF6B35;
    }

    /* Newsletter Form */
    .newsletter-form {
      display: flex;
      gap: 0.5rem;
    }

    .newsletter-form input {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
    }

    .newsletter-form button {
      padding: 0.75rem 1.5rem;
      background-color: #FF6B35;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .newsletter-form button:hover {
      background-color: #e65a2b;
    }

    /* Social Icons */
    .social-icons {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .social-icons a {
      color: white;
      font-size: 1.5rem;
      transition: color 0.3s ease;
    }

    .social-icons a:hover {
      color: #FFA500;
    }

    /* Copyright */
    .copyright {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.9rem;
      color: #ddd;
    }

        /* Animations */
        @keyframes fadeInUp {
            0% {
                transform: translateY(20px);
                opacity: 0;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Media Queries for Mobile Devices */
        @media (max-width: 768px) {
            .cart-item {
                flex-direction: column;
                align-items: center;
            }

            .card {
                margin-top: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom">
        <div class="container-fluid">
            <p class="navbar-brand fw-bold">
                <span class="logospan"> <span style="color:#FFA500;">Industrial</span>Rentals</span>
            </p>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" id="active-nav" href="../htmlPages/homeUserPage.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" id="rentals-link" href="../htmlPages/shopPage.html">Rentals</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" id="about-us-link" href="../htmlPages/aboutUsPage.html">About
                            Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" id="contact-us-link"
                            href="../htmlPages/contactUsPage.html">Contact Us</a>
                    </li>
                </ul>
                <div class="profile-cart">
                    <a href="../htmlPages/userPage.html">
                        <i class="fa-solid fa-user"></i> Profile
                    </a>
                    <a href="../htmlPages/cartPage.html">
                        <i class="fa-solid fa-basket-shopping"></i> Cart
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="GenralContainer">
        <main class="container mt-4">
            <div class="row">
                <!-- Tools List -->
                <div class="col-lg-8">
                    <div class="list-group" id="toolsContainer">
                        <!-- Tools will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Summary Section -->
                <div class="col-lg-4">
                    <div class="card p-3 bg-light shadow-sm">
                        <h4 class="mb-4">Rental Summary</h4>
                        <div class="d-flex justify-content-between mb-3">
                            <p>Subtotal</p>
                            <p id="subtotal">0 JD</p>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <p>Tax</p>
                            <p id="tax">0 JD</p>
                        </div>
                        <div class="d-flex justify-content-between mb-4">
                            <p><strong>Total</strong></p>
                            <p><strong id="total">0 JD</strong></p>
                        </div>
                        <a href="../htmlPages/checkOutPage.html"><button class="btn btn-primary w-100 py-2"><i
                                    class="bi bi-cart-check"></i> Proceed to
                                Checkout</button></a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>Industrial Rentals provides high-quality equipment for construction, agriculture, and industrial
                        needs.
                        Rent with ease and efficiency.</p>
                </div>

                <!-- Quick Links -->
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Rentals</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><i class='bx bx-map'></i> 123 Industrial Street, City, Country</li>
                        <li><i class='bx bx-phone'></i> +123 456 7890</li>
                        <li><i class='bx bx-envelope'></i> info@industrialrentals.com</li>
                    </ul>
                </div>

                <!-- Newsletter -->
                <div class="footer-section">
                    <h3>Subscribe to Our Newsletter</h3>
                    <form class="newsletter-form">
                        <input type="email" placeholder="Enter your email" required>
                        <button type="submit">Subscribe</button>
                    </form>
                </div>
            </div>

            <!-- Social Icons -->
            <div class="social-icons">
                <a href="#"><i class='bx bxl-facebook'></i></a>
                <a href="#"><i class='bx bxl-instagram'></i></a>
                <a href="#"><i class='bx bxl-twitter'></i></a>
                <a href="#"><i class='bx bxl-linkedin'></i></a>
            </div>

            <!-- Copyright -->
            <p class="copyright">&copy; 2023 Industrial Rentals. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, deleteDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";

        // Firebase configuration for Master project
        const firebaseConfig = {
            apiKey: "AIzaSyB2C4Djv2h0dMRluFw6NFSfQFtfkzZ6FAU",
            authDomain: "masterproject-158b4.firebaseapp.com",
            projectId: "masterproject-158b4",
            storageBucket: "masterproject-158b4.firebasestorage.app",
            messagingSenderId: "632368585512",
            appId: "1:632368585512:web:0a0100256c7cbd27cf8e1d",
            measurementId: "G-S33GMFE8W2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const toolsContainer = document.getElementById("toolsContainer");
        const subtotalElement = document.getElementById("subtotal");
        const taxElement = document.getElementById("tax");
        const totalElement = document.getElementById("total");

        let subtotal = 0;

        // Function to fetch tools based on userId
        async function fetchTools() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const productId = urlParams.get('id');

                if (!productId) {
                    console.log("No product ID found in URL.");
                    return;
                }

                const productRef = doc(db, "equipment", productId);
                const productSnap = await getDoc(productRef);

                if (productSnap.exists()) {
                    const product = productSnap.data();
                    const { name, description, image, price, availability } = product;

                    const priceNumber = parseFloat(price);

                    const toolHTML = `
                    <div class="list-group-item d-flex justify-content-between align-items-center tool-item" data-tool-id="${productId}">
                        <img src="${image}" alt="${name}" class="img-thumbnail" style="width: 100px; height: 100px; object-fit: cover;">
                        <div class="ms-3">
                            <h5 class="card-title">${name}</h5>
                            <p class="card-text">${description}</p>
                            <p class="card-text">Rental Price: ${priceNumber.toFixed(2)} JD</p>
                            <p class="card-text">Availability: ${availability ? "Available" : "Not Available"}</p>
                        </div>
                        <button class="btn btn-danger btn-sm remove-tool-btn" data-tool-id="${productId}" style="background-color: #9F8069; color: white;">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                    `;
                    toolsContainer.innerHTML = toolHTML; // Clear existing items and add the new one
                    subtotal = priceNumber;

                    const tax = subtotal * 0.15; // 15% tax
                    const total = subtotal + tax;

                    subtotalElement.textContent = `${subtotal.toFixed(2)} JD`;
                    taxElement.textContent = `${tax.toFixed(2)} JD`;
                    totalElement.textContent = `${total.toFixed(2)} JD`;
                } else {
                    console.log("No such document!");
                }
            } catch (error) {
                console.error("Error fetching tools: ", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load tools. Please try again later.',
                });
            }
        }

        // Function to remove tool
        async function removeTool(userId, toolId) {
            try {
                const confirmDelete = await Swal.fire({
                    title: 'Are you sure?',
                    text: "Do you want to Remove this tool?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, Remove it!'
                });

                if (!confirmDelete.isConfirmed) return;

                const toolsRef = collection(db, "cart"); // Change to "cart" collection
                const q = query(toolsRef, where("userId", "==", userId), where("__name__", "==", toolId));
                const querySnapshot = await getDocs(q);

                querySnapshot.forEach(async (doc) => {
                    await deleteDoc(doc.ref);
                });

                Swal.fire({
                    icon: 'success',
                    title: 'Remove!',
                    text: 'The tool has been successfully deleted.',
                });

                fetchTools();
            } catch (error) {
                console.error("Error removing tool: ", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to Remove the tool. Please try again later.',
                });
            }
        }

        // Monitor authentication state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                fetchTools();
            } else {
                Swal.fire({
                    icon: 'info',
                    title: 'Not Logged In',
                    text: 'Please log in to view your tools.',
                    showConfirmButton: true,
                }).then(() => {
                    window.location.href = "../htmlPages/login.html";
                });
            }
        });

        // Event listener for remove buttons
        toolsContainer.addEventListener("click", (e) => {
            if (e.target.closest(".remove-tool-btn")) {
                const toolId = e.target.closest(".remove-tool-btn").getAttribute("data-tool-id");
                const userId = auth.currentUser.uid;

                if (userId && toolId) {
                    removeTool(userId, toolId);
                }
            }
        });
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>